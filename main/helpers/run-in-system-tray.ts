import { app, BrowserWindow, Menu, nativeImage, Tray } from "electron";
import { APP_NAME } from "../../renderer/const";

export const runInSystemTray = (mainWindow: BrowserWindow) => {
  mainWindow.hide();
  const icon = nativeImage.createFromDataURL(
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAHdElNRQfoBxIDOSROMqd5AAAHrklEQVRYw+1W249dVRn/fd/ae5999rnNmTlz7bQzhbYwnbaUm0VBWiMooYAI8cGIEiURDYkaHvTBF42JiY8kBEL8C4yiSBSiASylWloKVFvaDjN0rm1nOrdz3fvsvddanw8tk1ppxQef5Jesl3X7fb+1vm+tH/AJ/t9B/8vN81kfDAAka331MP6XOc5/u2kx8K8qp95qAwAKWR9ElwxcAfxxCAtBFsXARzHwwUToDUr4w11PoB62uR62+Qfb7oanHFgra/MAQERQD9sFo+0djsvqCjFfWaUAYCLsqGzAG9NjLggD+ay/pSMTjHR5uY1Zx+0hYq7GrZm51urrjbC9z884oZ/3UF0OVQbuDeu3l56khLrGxxYfLgZ+WA/bH30FhUIBZFIYsRAIRjsH8ebcBznPd0fnw9oddw2N3D6cK4+uzxR6Cp7vV7JF7nJ8q12HUxE+sjL3+EvTR3/7j4W5H2Y8d2jDzo4nOq/P3LPztsGe6vFkYnxssQtAeLlY50PF9UYDnbkABz77Lex45ZnBpXbznvs2bntoa7Fn52CuXBrOld1eNxCXSBMraehEJxAqW0naRuP+ziG3C/yVZ3SUV3v80eHdwdZyzrHrB8pGGrXuDj87QIpmL88hpxj4aJkE13d243Rr9ZpH33nh649t3vXgjZ2DWzZnS16R3ZSIdQQrTZM4vhUHIswQitK2cZTrWBFJiOytxV6+qbvvwdNbEydbViaIsmmm7GSKPX4myHsdZ5dqAYAcg3RPT74aNlNRhgXTX3gSvxg/sPf+vi3PPTK4/eFbiv2VHtdXgXKViOU0TZQCvNSk3DYpucQMEbismEHETG5qDQJ2nDBN6WTvspQrrhkcKDuNhZin3loxK83WNUM7y49ev7338Qw5O6anV/+UcR3tVLwAI68+/cX7+6775dcGt/eVlKctoCKTaisCAMxKETFzFkx1HacCEESE6UKmE8iQAGkam6J1SNWMcIvl2KsLEqaRyQ+53p23D9/ZV+hIs6nHrzw7/rexk+fbAODMNxqdewau+dHD67b2Fz1frLHEzCoLR4guVDIR8Yd1FbDDEKuZWVlrrSKmNIkTFnGqrZatNepoTLTpvchycUsG60dy1NdRNEXK6VzB4zPH6vHM2OrLm7ZU5PxcE46XcW7cUerdmXe9NLGGM8pRAIhZqcvLlEBgC9vSWpaTVlo3ISU6QRrF0kRC0neOSiN1erwYspsjrDaUfe+VjD1VCFG5tsCljkCdPlgfn5mpHd52rYt2THByjtfvOOSMu8vN69JKSayxIKY11YCQALG1mI8bMqmnjVTO0cDGFRrujUkpwXKD1fsLYrIZS5/ZYdVtW4XBAAx4pRHZ3xxsyssvKrvtZjEVRn/lbn7q7xP2RcB5wUmsqWltpScJAo8VGa0NkQUrBSam2FiZap/T1Y7TMnDTGfrSaNPZuE44CECgi8ciEFjYM6tkXjqk7JExwjf3piqXBXeWob59rzaTs0pXFPir96JjYjb/wLOpu3tyrj6rUhg74OUeuCM30KNAkqSJ1kZbWEtLrXp6Qh2TrbuPyN4vL/DNNyZuTwXKdUGQtQYICAAXc1Ajg9a+vn+dPjXpYudIpJS68KROT3br114cEPfdTbHM3konFp2Jt89NPqNgsRpB93WKur0XjtTiltFpQiZO+W17ku578CTftssovwRnjfBKEMBVgJt0pqcPfkpauWneNKQ5TWGOHh3Q06eyVI7YzujU7FuaevrHN+/9MwdZT6bjxlPPL088//LiB7oZtyEippkmqde1gs0bQMaAYK9KvYY4ha3Pl+im7LA5fLBfR23I2bNsVibKCP0qFvrO8ywvhvNR48DPj/4RjkOMgJ3F99qr362Z9PhYu/bIdX5pXQEuqoGmOAK8HEi3ICoAiK/wtxJgBfrYqbKlqRvYswnNn3Xo7ePQ42+sl5VpUcNJTm5pb5ATkmrisxGMhcq4DpgIijha+uxP9n9j/Pcvjcf1d07G9ePn4qQ52m83b+wREIHFXLgEYgC8loQCC1ldRXL4zX5d/evnqDOtOM2oLvvPTSE+0Ut8ph/vNM87Fbjm/bgZHqidfXUiqv7aWhOtqbn0k/CIUWYP41G4Yc8674Xv3Kq277ghlK4eTZmsECmIJdhI2FRrGbs006VWJoY5szyMosopEisnG4t63+wJ2uV18mvR+bnD4eJfAlbjiyY+vBpFb3Xm8g2+mh+oh8DmXAYrRj+0xy8/e2dHoVzqJhN0KCaGWO2yafui0oKUs31OVnkQWDHWmKmwqn41d4yLqW2dN+1D77ZXf1Z9Ltp/1/fX4VhSQ2T1xeO7ilcqBj5CMdBRSn253GOfdko/3Z3r69pQ7IbvB0yEC4+VWO1lAxHXoTNxUx1anWscWJ45PBvWjnrMh+aT1r4BL79yTkfwVRauaFxqSq5qSouBj0gs0ihBIch8fpOT/96o37FrKF8udTo+JyTU1KldSqP6giQLk1HtyFRY/V0tbL+2sdjRTKxB3Sbgi9V7uRv6jwF8GEQsFkVysKjDXEa520vK25Zlp2JEktDq+aZJppJET8JioTuft5FJwRcdqQBofATxxw7g8gQlAHnlouJk0RaNFR0jtubf1tSvQvoJPsGl+CdQhd8aHGOOdgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNC0wNy0xOFQwMzo1NzoyNyswMDowMEd1yLMAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjQtMDctMThUMDM6NTc6MjcrMDA6MDA2KHAPAAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDI0LTA3LTE4VDAzOjU3OjM2KzAwOjAwC+Ba+gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII="
  );
  const tray = new Tray(icon);

  const showMainWindow = () => {
    mainWindow.show();
    tray.destroy();
  };

  const contextMenu = Menu.buildFromTemplate([
    { label: "Hiện", type: "normal", click: showMainWindow },
    { label: "Thoát", type: "normal", click: handleQuit },
  ]);

  tray.setToolTip(APP_NAME);
  tray.setContextMenu(contextMenu);
  tray.on("double-click", () => {
    showMainWindow();
  });
};

function handleQuit() {
  if (process.platform !== "darwin") {
    app.quit();
  }
}
